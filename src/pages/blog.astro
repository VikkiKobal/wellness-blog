---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import PageHero from '../components/PageHero.astro';
import BlogArticleCard from '../components/BlogArticleCard.astro';
import Pagination from '../components/Pagination.astro';
import Footer from '../components/Footer.astro';
import * as api from '../utils/api';

// Pagination settings
const ARTICLES_PER_PAGE = 10;
const currentPage = parseInt(Astro.url.searchParams.get('page') || '1');

// Fetch articles from Go Backend
let articles = [];
let totalPages = 1;

try {
  const dbArticles = await api.getArticles();
  const totalArticles = dbArticles.length;
  totalPages = Math.max(1, Math.ceil(totalArticles / ARTICLES_PER_PAGE));
  
  const offset = (currentPage - 1) * ARTICLES_PER_PAGE;
  
  articles = dbArticles.slice(offset, offset + ARTICLES_PER_PAGE).map(article => ({
    id: article.id,
    title: article.title,
    date: article.date,
    author: article.author || 'Antonina Devitska',
    image: article.image || '/images/blog-1.png',
    excerpt: article.excerpt || '',
    category: article.category || '',
    href: `/blog/${article.id}`,
  }));
} catch (error) {
  console.error('Error fetching articles from backend:', error);
}

const breadcrumb = [
  { label: 'Home', href: '/' },
  { label: 'Blog', href: '/blog' }
];
---

<Layout title="Blog | Antonina Devitska" description="Explore articles and stories on education, wellbeing, and personal growth.">
  <Header currentPage="blog" />
  
  <main>
    <PageHero 
      title="Welcome to My Blog" 
      breadcrumb={breadcrumb}
    />
    
    <section class="blog-section">
      <div class="container">
        <div class="blog-header">
          <h2 class="section-title">My Articles & Stories</h2>
          <p class="section-description">
            Explore my collection of articles and stories, where I share insights, experiences, and reflections from my work and learning journey. Each piece is written to inspire, inform, and spark new perspectives for your own growth.
          </p>
        </div>
        
        <div class="divider"></div>
        
        <div class="articles-grid">
          {articles.map(article => (
            <BlogArticleCard {...article} />
          ))}
        </div>
        
        <Pagination currentPage={currentPage} totalPages={totalPages} />
      </div>
    </section>
  </main>
  
  <Footer />
</Layout>

<style>
  .blog-section {
    padding: 60px 0 100px;
  }
  
  .blog-header {
    margin-bottom: 40px;
  }
  
  .section-title {
    font-family: var(--font-primary);
    font-weight: 600;
    font-size: 32px;
    line-height: 2.33;
    color: var(--color-primary);
    margin-bottom: 16px;
  }
  
  .section-description {
    font-family: var(--font-secondary);
    font-weight: 400;
    font-size: 16px;
    line-height: 1.85;
    color: #454545;
    max-width: 1131px;
  }
  
  .divider {
    height: 1px;
    background: var(--color-gray);
    margin-bottom: 40px;
  }
  
  .articles-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 32px 24px;
  }
  
  @media (max-width: 1100px) {
    .articles-grid {
      grid-template-columns: 1fr;
      gap: 24px;
    }
  }
  
  @media (max-width: 768px) {
    .blog-section {
      padding: 40px 0 80px;
    }
    
    .section-title {
      font-size: 26px;
    }
    
    .section-description {
      font-size: 14px;
    }
  }
</style>













